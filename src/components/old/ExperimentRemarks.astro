---
import {db, eq, experiments} from "astro:db";
import {currentExperimentId} from "../../lib/old/state.ts";

const props = Astro.props;

let remark = ""
ACTIVE: if(currentExperimentId.value) {
  const currentExperiment = await db.select().from(experiments).where(eq(experiments.id, currentExperimentId.value));
  if(!currentExperiment?.length) {
    break ACTIVE;
  }
  remark = currentExperiment[0].remark ?? ""
}
---
<textarea
  id="experiment-remarks"
  disabled={!currentExperimentId.value}
  name="remark"
  hx-post="/api/experiment/remark"
  hx-include="this"
  hx-swap="outerHTML"
  hx-trigger="keyup delay:500ms change"
  class="w-full h-24 p-2 border border-gray-300 rounded-md disabled:opacity-50 text-start"
  {...props}
>{remark}</textarea>
